# Visualization Tool for Large-scale Multi-agent Safe Control with Neural Contraction Metrics and Barrier Certificates

## Prerequisites
- Ubuntu 18.04 or 20.04
- Python 3.6

## Installation
Run the following command to install the required packages.
```bash
pip install -r requirements.txt
```
To use `gurobipy`, you need to require a license from the official website of [Gurobi](https://www.gurobi.com/).

## Run Simulation
Run the following command to run the simulation and generate the trajectory for a given environment. `NUM_AGENTS` is the number of agents in the environment. `OUTPUT_PATH` is the path to save the trajectory data. `SCENE` can be either `delivery` or `tunnel`. `SEED` is an integer. Default to 0. 
```bash
python run.py --model_path data/model_default_iter_7000 --vis 1 --num_agents NUM_AGENTS --output OUTPUT_PATH --scene SCENE --seed SEED 
```

## Visualize in Blender
Please follow the 5 steps below to visualize the simulation environment and results.

- Install [Blender](https://www.blender.org/). 
- Download the [FBX file of Drone](https://drive.google.com/file/d/1XqTxS6cQl4Kzeg937kZMzGgLu-KyhKhq/view?usp=sharing), and the blender scene file for the [tunnel](https://drive.google.com/file/d/1Zn9gLamW5pTFnaRrtqLV5248kjlaPetK/view?usp=sharing) and [delivery](https://drive.google.com/file/d/1T0z9mFy_7QSvwCp52T3cS801I8Wx8qmx/view?usp=sharing) environments. 
- Modify the `DRONE_FBX` in `vis/blender.py` to point to the FBX file of the drone. Modify the `TRAJ_PATH` in `vis/blender.py` to point to the trajectory data generated by `run.py`.
- Open Blender and load the one of the `*.blend` files. Run `vis/blender.py` in the Python terminal of Blender to load the trajectory data and insert keyframes.
- Adjust the camera to a desired viewpoint and start rendering.